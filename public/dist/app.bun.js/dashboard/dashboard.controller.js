'use strict';(function(){angular.module('nerveCenter').controller('dashboardCtrl',dashboardCtrl);function dashboardCtrl($scope,$http,$location,$uibModal,$log,$document,$filter,$window,apiData,auth){var $dshBrd=this;$scope.draggable=false;$scope.deleteEnabled=false;$scope.urlsEnabled=true;$scope.areIconsLoaded=false;$scope.deleteIcon='img/_x.png';$scope.lockIcon='img/_locked.png';updateWidgets();function instantiateGridster(){var width=this.window.outerWidth;var adjustedGridOptions=gridOptions;if(width>500){adjustedGridOptions.columns=7}else{adjustedGridOptions.columns=3}return adjustedGridOptions}function checkScreenSize(){var start=$window.outerWidth;if(start>500){$dshBrd.screenSize='lg'}else{$dshBrd.screenSize='sm'}}function updateToolIconSize(){$scope.toolIconSize=$dshBrd.screenSize=='sm'?$scope.toolIconSize=28+'px':$scope.toolIconSize=20+'px'}updateToolIconSize();function updateWidgets(){checkScreenSize();$dshBrd.lastScreenSize=inputScreenSize($window.outerWidth);apiData.getProfile().success(function(user){$dshBrd.widgetsLg=angular.fromJson(user.widgetsLg);$dshBrd.widgetsSm=angular.fromJson(user.widgetsSm)}).error(function(){$scope.openAuthModal()}).finally(function(){$scope.widgets=$dshBrd.screenSize=='lg'?$dshBrd.widgetsLg:$dshBrd.widgetsSm;$scope.gridOptions=instantiateGridster();$dshBrd.currentWidth=$window.outerWidth;getIcons()})}$dshBrd.saveWidgets=function(){checkScreenSize();if($dshBrd.screenSize=='lg'){$dshBrd.widgetsLg=$scope.widgets}else{$dshBrd.widgetsSm=$scope.widgets}data=[$dshBrd.widgetsLg,$dshBrd.widgetsSm];apiData.updateWidgets(data).success(function(data){console.log('Successfully updated widgets')}).error(function(e){console.log(e)})};$scope.createWidget=function(){var widgetUrl=$scope.widgetUrl;var widgetWeight=$scope.widgetWeight;var widgetIcon=$scope.selectedIcon;var defaultIcon='img/_blank.png';if(!widgetUrl&&widgetIcon===defaultIcon){window.alert('Please Enter URL and Select an Icon');return}else if(!widgetUrl){window.alert('Please Enter URL');return}else if(widgetIcon===defaultIcon){window.alert('Please Select an Icon');return}function pushNewWidget(size){if(size==='lg'){var len=$dshBrd.widgetsLg.length;var columns=7;var newWidget=createNewWidget(len,columns);$dshBrd.widgetsLg.push(newWidget)}else if(size==='sm'){var len=$dshBrd.widgetsSm.length;var columns=3;var newWidget=createNewWidget(len,columns);$dshBrd.widgetsSm.push(newWidget)}}function createNewWidget(len,columns){var newWidget={type:'link-widget',sizeX:1,sizeY:1,icon:widgetIcon,url:widgetUrl,row:Math.floor(len/columns),col:len%columns+1};return newWidget}pushNewWidget('lg');pushNewWidget('sm');$dshBrd.saveWidgets();$location.path('dashboard.view')};$scope.importWidgets=function(){var widgetString=angular.fromJson($scope.widgetString);$scope.widgets=widgetString;checkScreenSize();if($dshBrd.screenSize=='lg'){$dshBrd.widgetsLg=widgetString}else{$dshBrd.widgetsSm=widgetString}$dshBrd.saveWidgets();$location.path('dashboard.view')};$scope.deleteWidget=function(widget){$scope.widgets=$scope.widgets.filter(function(element){return element.url!=widget.url});$dshBrd.saveWidgets()};$scope.toggleDraggable=function(){gridOptions.draggable.enabled=!gridOptions.draggable.enabled;$scope.urlsEnabled=!$scope.urlsEnabled;if($scope.deleteEnabled){$scope.deleteEnabled=false;$scope.deleteIcon='img/_x.png'}if(gridOptions.draggable.enabled){$scope.lockIcon='img/_lockedRed.png'}else{$scope.lockIcon='img/_locked.png'}if(!gridOptions.draggable.enabled)$dshBrd.saveWidgets()};$scope.toggleDelete=function(){$scope.deleteEnabled=!$scope.deleteEnabled;$scope.urlsEnabled=!$scope.urlsEnabled;if($scope.deleteEnabled){$scope.deleteIcon='img/_xRed.png'}else{$scope.deleteIcon='img/_x.png'}if(gridOptions.draggable.enabled){gridOptions.draggable.enabled=false;$scope.lockIcon='img/_locked.png'}};function getIcons(){apiData.getIcons().success(function(icons){$dshBrd.icons=icons}).finally(function(){$dshBrd.allIcons=[];var len=$dshBrd.icons.length;for(i=0;i<len;i++){var iconObj={};var iconString='img/ico/'+$dshBrd.icons[i];iconObj.path=iconString;$dshBrd.allIcons.push(iconObj)}$scope.shownIcons=[];$scope.loadSomeIcons()})}$scope.loadAllIcons=function(){var allIcons=[];var totalIcons=$dshBrd.allIcons.length-1;$scope.areIconsLoaded=true;for(var i=0;i<=totalIcons;i++){var newIco=$dshBrd.allIcons[i];allIcons.push(newIco)}$scope.shownIcons=allIcons};$scope.loadSomeIcons=function(){for(var i=0;i<=24;i++){var newIco=$dshBrd.allIcons[i];$scope.shownIcons.push(newIco)}};$scope.gridsterModalOptions=gridsterModalOptions;$scope.selectedIcon='img/_blank.png';$scope.selectIcon=function(iconPath){$scope.selectedIcon=iconPath};$scope.openMainModal=function(size,parentSelector){gridOptions.draggable.enabled=false;$scope.deleteEnabled=false;var parentElem=parentSelector?angular.element($document[0].querySelector('.modal-demo')):undefined;var modalInstance=$uibModal.open({templateUrl:'mainModal.html',controller:'dashboardCtrl',size:'lg',appendTo:parentElem})};$scope.openAuthModal=function(size,parentSelector){var parentElem=parentSelector?angular.element($document[0].querySelector('.main-modal')):undefined;var modalInstance=$uibModal.open({templateUrl:'authModal.html',controller:'authCtrl',controllerAs:'$auth',appendTo:parentElem})};$scope.onLogout=function(){auth.logout();$location.path('dashboard.view')};$scope.syncWidgets=function(){$dshBrd.widgetsLg=$scope.widgets;$dshBrd.widgetsSm=$scope.widgets;$dshBrd.saveWidgets();$location.path('dashboard.view')};$scope.resetWidgets=function(){checkScreenSize();apiData.getDefaultGrid().success(function(defaultGrid){defaultGrid=angular.fromJson(defaultGrid);$scope.widgets=defaultGrid;if($dshBrd.screenSize=='lg'){$dshBrd.widgetsLg=defaultGrid}else{$dshBrd.widgetsSm=defaultGrid}}).error(function(e){console.log(e)}).finally(function(){$dshBrd.saveWidgets();$location.path('dashboard.view')})};$scope.clearGrid=function(){$scope.widgets=[];if($dshBrd.screenSize=='lg'){$dshBrd.widgetsLg=[]}else{$dshBrd.widgetsSm=[]}$dshBrd.saveWidgets();$location.path('dashboard.view')};var resizeBreaks={'sm':500};function inputScreenSize(width){if(width>500){return'lg'}else{return'sm'}}angular.element($window).bind('resize',function(){var oldWidth=$dshBrd.currentWidth;var oldSize=$dshBrd.lastScreenSize;var newWidth=$window.outerWidth;var newSize=inputScreenSize(newWidth);if(oldSize!==newSize){$location.path('dashboard.view')}$dshBrd.lastScreenSize=newSize})};})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhc2hib2FyZC9kYXNoYm9hcmQuY29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsImRhc2hib2FyZEN0cmwiLCIkc2NvcGUiLCIkaHR0cCIsIiRsb2NhdGlvbiIsIiR1aWJNb2RhbCIsIiRsb2ciLCIkZG9jdW1lbnQiLCIkZmlsdGVyIiwiJHdpbmRvdyIsImFwaURhdGEiLCJhdXRoIiwiJGRzaEJyZCIsImRyYWdnYWJsZSIsImRlbGV0ZUVuYWJsZWQiLCJ1cmxzRW5hYmxlZCIsImFyZUljb25zTG9hZGVkIiwiZGVsZXRlSWNvbiIsImxvY2tJY29uIiwidXBkYXRlV2lkZ2V0cyIsImluc3RhbnRpYXRlR3JpZHN0ZXIiLCJ3aWR0aCIsIndpbmRvdyIsIm91dGVyV2lkdGgiLCJhZGp1c3RlZEdyaWRPcHRpb25zIiwiZ3JpZE9wdGlvbnMiLCJjb2x1bW5zIiwiY2hlY2tTY3JlZW5TaXplIiwic3RhcnQiLCJzY3JlZW5TaXplIiwidXBkYXRlVG9vbEljb25TaXplIiwidG9vbEljb25TaXplIiwibGFzdFNjcmVlblNpemUiLCJpbnB1dFNjcmVlblNpemUiLCJnZXRQcm9maWxlIiwic3VjY2VzcyIsInVzZXIiLCJ3aWRnZXRzTGciLCJmcm9tSnNvbiIsIndpZGdldHNTbSIsImVycm9yIiwib3BlbkF1dGhNb2RhbCIsImZpbmFsbHkiLCJ3aWRnZXRzIiwiY3VycmVudFdpZHRoIiwiZ2V0SWNvbnMiLCJzYXZlV2lkZ2V0cyIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwiZSIsImNyZWF0ZVdpZGdldCIsIndpZGdldFVybCIsIndpZGdldFdlaWdodCIsIndpZGdldEljb24iLCJzZWxlY3RlZEljb24iLCJkZWZhdWx0SWNvbiIsImFsZXJ0IiwicHVzaE5ld1dpZGdldCIsInNpemUiLCJsZW4iLCJsZW5ndGgiLCJuZXdXaWRnZXQiLCJjcmVhdGVOZXdXaWRnZXQiLCJwdXNoIiwidHlwZSIsInNpemVYIiwic2l6ZVkiLCJpY29uIiwidXJsIiwicm93IiwiTWF0aCIsImZsb29yIiwiY29sIiwicGF0aCIsImltcG9ydFdpZGdldHMiLCJ3aWRnZXRTdHJpbmciLCJkZWxldGVXaWRnZXQiLCJ3aWRnZXQiLCJmaWx0ZXIiLCJlbGVtZW50IiwidG9nZ2xlRHJhZ2dhYmxlIiwiZW5hYmxlZCIsInRvZ2dsZURlbGV0ZSIsImljb25zIiwiYWxsSWNvbnMiLCJpIiwiaWNvbk9iaiIsImljb25TdHJpbmciLCJzaG93bkljb25zIiwibG9hZFNvbWVJY29ucyIsImxvYWRBbGxJY29ucyIsInRvdGFsSWNvbnMiLCJuZXdJY28iLCJncmlkc3Rlck1vZGFsT3B0aW9ucyIsInNlbGVjdEljb24iLCJpY29uUGF0aCIsIm9wZW5NYWluTW9kYWwiLCJwYXJlbnRTZWxlY3RvciIsInBhcmVudEVsZW0iLCJxdWVyeVNlbGVjdG9yIiwidW5kZWZpbmVkIiwibW9kYWxJbnN0YW5jZSIsIm9wZW4iLCJ0ZW1wbGF0ZVVybCIsImFwcGVuZFRvIiwiY29udHJvbGxlckFzIiwib25Mb2dvdXQiLCJsb2dvdXQiLCJzeW5jV2lkZ2V0cyIsInJlc2V0V2lkZ2V0cyIsImdldERlZmF1bHRHcmlkIiwiZGVmYXVsdEdyaWQiLCJjbGVhckdyaWQiLCJyZXNpemVCcmVha3MiLCJiaW5kIiwib2xkV2lkdGgiLCJvbGRTaXplIiwibmV3V2lkdGgiLCJuZXdTaXplIl0sIm1hcHBpbmdzIjoiYUFBQSxDQUFDLFVBQVksQ0FFWEEsUUFDQ0MsTUFEREQsQ0FDUSxhQURSQSxFQUVDRSxVQUZERixDQUVZLGVBRlpBLENBRTZCRyxhQUY3QkgsRUFJQSxRQUFTRyxjQUFULENBQXVCQyxNQUF2QixDQUErQkMsS0FBL0IsQ0FBc0NDLFNBQXRDLENBQ0VDLFNBREYsQ0FDYUMsSUFEYixDQUNtQkMsU0FEbkIsQ0FDOEJDLE9BRDlCLENBQ3VDQyxPQUR2QyxDQUNnREMsT0FEaEQsQ0FDeURDLElBRHpELENBQytELENBRTNELEdBQUlDLFNBQVUsSUFBZCxDQUVBVixPQUFPVyxTQUFQWCxDQUFt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LENBQWUsZ0JBQWZBLENBUkYsQ0FBQUYsQ0FXQSxHQUFJZ0gsY0FBZSxDQUNqQixLQUFPLEdBRFUsQ0FBbkIsQ0FJQSxRQUFTakYsZ0JBQVQsQ0FBeUJaLEtBQXpCLENBQWdDLENBQzlCLEdBQUlBLE1BQVEsR0FBWixDQUFpQixDQUNmLE1BQU8sSUFEVCxDQUFBLElBRU8sQ0FDTCxNQUFPLElBQ1IsQ0FDRixDQUVEdkIsUUFBUWtGLE9BQVJsRixDQUFnQlcsT0FBaEJYLEVBQXlCcUgsSUFBekJySCxDQUE4QixRQUE5QkEsQ0FBd0MsVUFBWSxDQUNsRCxHQUFJc0gsVUFBV3hHLFFBQVFnQyxZQUF2QixDQUNBLEdBQUl5RSxTQUFVekcsUUFBUW9CLGNBQXRCLENBQ0EsR0FBSXNGLFVBQVc3RyxRQUFRYyxVQUF2QixDQUNBLEdBQUlnRyxTQUFVdEYsZ0JBQWdCcUYsUUFBaEJyRixDQUFkLENBRUEsR0FBSW9GLFVBQVlFLE9BQWhCLENBQXlCLENBQ3ZCbkgsVUFBVXNFLElBQVZ0RSxDQUFlLGdCQUFmQSxDQUNELENBRURRLFFBQVFvQixjQUFScEIsQ0FBeUIyRyxPQVYzQixDQUFBekgsQ0FZRCxFQTVWTCxDQUFBIiwiZmlsZSI6ImRhc2hib2FyZC9kYXNoYm9hcmQuY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG5cbiAgYW5ndWxhclxuICAubW9kdWxlKCduZXJ2ZUNlbnRlcicpXG4gIC5jb250cm9sbGVyKCdkYXNoYm9hcmRDdHJsJywgZGFzaGJvYXJkQ3RybCk7XG5cbiAgZnVuY3Rpb24gZGFzaGJvYXJkQ3RybCgkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sXG4gICAgJHVpYk1vZGFsLCAkbG9nLCAkZG9jdW1lbnQsICRmaWx0ZXIsICR3aW5kb3csIGFwaURhdGEsIGF1dGgpIHtcblxuICAgICAgdmFyICRkc2hCcmQgPSB0aGlzO1xuXG4gICAgICAkc2NvcGUuZHJhZ2dhYmxlID0gZmFsc2U7XG4gICAgICAkc2NvcGUuZGVsZXRlRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgJHNjb3BlLnVybHNFbmFibGVkID0gdHJ1ZTtcbiAgICAgICRzY29wZS5hcmVJY29uc0xvYWRlZCA9IGZhbHNlO1xuICAgICAgJHNjb3BlLmRlbGV0ZUljb24gPSAnaW1nL194LnBuZyc7XG4gICAgICAkc2NvcGUubG9ja0ljb24gPSAnaW1nL19sb2NrZWQucG5nJztcblxuICAgICAgdXBkYXRlV2lkZ2V0cygpO1xuXG4gICAgICBmdW5jdGlvbiBpbnN0YW50aWF0ZUdyaWRzdGVyKCkge1xuICAgICAgICB2YXIgd2lkdGggPSB0aGlzLndpbmRvdy5vdXRlcldpZHRoO1xuICAgICAgICB2YXIgYWRqdXN0ZWRHcmlkT3B0aW9ucyA9IGdyaWRPcHRpb25zO1xuICAgICAgICBpZiAod2lkdGggPiA1MDApIHtcbiAgICAgICAgICBhZGp1c3RlZEdyaWRPcHRpb25zLmNvbHVtbnMgPSA3O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFkanVzdGVkR3JpZE9wdGlvbnMuY29sdW1ucyA9IDM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFkanVzdGVkR3JpZE9wdGlvbnM7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNoZWNrU2NyZWVuU2l6ZSgpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gJHdpbmRvdy5vdXRlcldpZHRoO1xuICAgICAgICBpZiAoc3RhcnQgPiA1MDApIHtcbiAgICAgICAgICAkZHNoQnJkLnNjcmVlblNpemUgPSAnbGcnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRkc2hCcmQuc2NyZWVuU2l6ZSA9ICdzbSc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gdXBkYXRlVG9vbEljb25TaXplKCkge1xuICAgICAgICAkc2NvcGUudG9vbEljb25TaXplID1cbiAgICAgICAgJGRzaEJyZC5zY3JlZW5TaXplID09ICdzbSdcbiAgICAgICAgPyAkc2NvcGUudG9vbEljb25TaXplID0gMjggKyAncHgnXG4gICAgICAgIDogJHNjb3BlLnRvb2xJY29uU2l6ZSA9IDIwICsgJ3B4JztcbiAgICAgIH1cblxuICAgICAgdXBkYXRlVG9vbEljb25TaXplKCk7XG5cbiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVdpZGdldHMoKSB7XG4gICAgICAgIGNoZWNrU2NyZWVuU2l6ZSgpO1xuICAgICAgICAkZHNoQnJkLmxhc3RTY3JlZW5TaXplID0gaW5wdXRTY3JlZW5TaXplKCR3aW5kb3cub3V0ZXJXaWR0aCk7XG4gICAgICAgIGFwaURhdGEuZ2V0UHJvZmlsZSgpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgJGRzaEJyZC53aWRnZXRzTGcgPSBhbmd1bGFyLmZyb21Kc29uKHVzZXIud2lkZ2V0c0xnKTtcbiAgICAgICAgICAkZHNoQnJkLndpZGdldHNTbSA9IGFuZ3VsYXIuZnJvbUpzb24odXNlci53aWRnZXRzU20pO1xuICAgICAgICB9KVxuICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICRzY29wZS5vcGVuQXV0aE1vZGFsKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkc2NvcGUud2lkZ2V0cyA9XG4gICAgICAgICAgJGRzaEJyZC5zY3JlZW5TaXplID09ICdsZydcbiAgICAgICAgICA/ICRkc2hCcmQud2lkZ2V0c0xnXG4gICAgICAgICAgOiAkZHNoQnJkLndpZGdldHNTbTtcblxuICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucyA9IGluc3RhbnRpYXRlR3JpZHN0ZXIoKTtcbiAgICAgICAgICAkZHNoQnJkLmN1cnJlbnRXaWR0aCA9ICR3aW5kb3cub3V0ZXJXaWR0aDtcblxuICAgICAgICAgIGdldEljb25zKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAkZHNoQnJkLnNhdmVXaWRnZXRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjaGVja1NjcmVlblNpemUoKTtcblxuICAgICAgICBpZiAoJGRzaEJyZC5zY3JlZW5TaXplID09ICdsZycpIHtcbiAgICAgICAgICAkZHNoQnJkLndpZGdldHNMZyA9ICRzY29wZS53aWRnZXRzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRkc2hCcmQud2lkZ2V0c1NtID0gJHNjb3BlLndpZGdldHM7XG4gICAgICAgIH1cblxuICAgICAgICBkYXRhID0gW1xuICAgICAgICAgICRkc2hCcmQud2lkZ2V0c0xnLFxuICAgICAgICAgICRkc2hCcmQud2lkZ2V0c1NtXG4gICAgICAgIF07XG5cbiAgICAgICAgYXBpRGF0YS51cGRhdGVXaWRnZXRzKGRhdGEpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSB1cGRhdGVkIHdpZGdldHMnKVxuICAgICAgICB9KVxuICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5jcmVhdGVXaWRnZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB3aWRnZXRVcmwgPSAkc2NvcGUud2lkZ2V0VXJsO1xuICAgICAgICB2YXIgd2lkZ2V0V2VpZ2h0ID0gJHNjb3BlLndpZGdldFdlaWdodDtcbiAgICAgICAgdmFyIHdpZGdldEljb24gPSAkc2NvcGUuc2VsZWN0ZWRJY29uO1xuXG4gICAgICAgIHZhciBkZWZhdWx0SWNvbiA9IFwiaW1nL19ibGFuay5wbmdcIjtcbiAgICAgICAgLy8gRm9ybSB2YWxpZGF0aW9uXG4gICAgICAgIGlmICghd2lkZ2V0VXJsICYmIHdpZGdldEljb24gPT09IGRlZmF1bHRJY29uKSB7XG4gICAgICAgICAgd2luZG93LmFsZXJ0KFwiUGxlYXNlIEVudGVyIFVSTCBhbmQgU2VsZWN0IGFuIEljb25cIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2UgaWYgKCF3aWRnZXRVcmwpIHtcbiAgICAgICAgICB3aW5kb3cuYWxlcnQoXCJQbGVhc2UgRW50ZXIgVVJMXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIGlmICh3aWRnZXRJY29uID09PSBkZWZhdWx0SWNvbikge1xuICAgICAgICAgIHdpbmRvdy5hbGVydChcIlBsZWFzZSBTZWxlY3QgYW4gSWNvblwiKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBwdXNoTmV3V2lkZ2V0KHNpemUpIHtcbiAgICAgICAgICBpZiAoc2l6ZSA9PT0gJ2xnJykge1xuICAgICAgICAgICAgdmFyIGxlbiA9ICRkc2hCcmQud2lkZ2V0c0xnLmxlbmd0aDtcbiAgICAgICAgICAgIHZhciBjb2x1bW5zID0gNztcbiAgICAgICAgICAgIHZhciBuZXdXaWRnZXQgPSBjcmVhdGVOZXdXaWRnZXQobGVuLCBjb2x1bW5zKTtcbiAgICAgICAgICAgICRkc2hCcmQud2lkZ2V0c0xnLnB1c2gobmV3V2lkZ2V0KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHNpemUgPT09ICdzbScpIHtcbiAgICAgICAgICAgIHZhciBsZW4gPSAkZHNoQnJkLndpZGdldHNTbS5sZW5ndGg7XG4gICAgICAgICAgICB2YXIgY29sdW1ucyA9IDM7XG4gICAgICAgICAgICB2YXIgbmV3V2lkZ2V0ID0gY3JlYXRlTmV3V2lkZ2V0KGxlbiwgY29sdW1ucyk7XG4gICAgICAgICAgICAkZHNoQnJkLndpZGdldHNTbS5wdXNoKG5ld1dpZGdldCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlTmV3V2lkZ2V0KGxlbiwgY29sdW1ucykge1xuICAgICAgICAgIHZhciBuZXdXaWRnZXQgPSB7XG4gICAgICAgICAgICB0eXBlOiAnbGluay13aWRnZXQnLFxuICAgICAgICAgICAgc2l6ZVg6IDEsXG4gICAgICAgICAgICBzaXplWTogMSxcbiAgICAgICAgICAgIGljb246IHdpZGdldEljb24sXG4gICAgICAgICAgICB1cmw6IHdpZGdldFVybCxcbiAgICAgICAgICAgIHJvdzogTWF0aC5mbG9vcihsZW4gLyBjb2x1bW5zKSxcbiAgICAgICAgICAgIGNvbDogKGxlbiAlIGNvbHVtbnMpICsgMVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbmV3V2lkZ2V0O1xuICAgICAgICB9XG5cbiAgICAgICAgcHVzaE5ld1dpZGdldCgnbGcnKTtcbiAgICAgICAgcHVzaE5ld1dpZGdldCgnc20nKTtcblxuICAgICAgICAkZHNoQnJkLnNhdmVXaWRnZXRzKCk7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQudmlldycpO1xuICAgICAgfVxuXG4gICAgICAkc2NvcGUuaW1wb3J0V2lkZ2V0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdpZGdldFN0cmluZyA9IGFuZ3VsYXIuZnJvbUpzb24oJHNjb3BlLndpZGdldFN0cmluZyk7XG4gICAgICAgICRzY29wZS53aWRnZXRzID0gd2lkZ2V0U3RyaW5nO1xuXG4gICAgICAgIGNoZWNrU2NyZWVuU2l6ZSgpO1xuICAgICAgICBpZiAoJGRzaEJyZC5zY3JlZW5TaXplID09ICdsZycpIHtcbiAgICAgICAgICAkZHNoQnJkLndpZGdldHNMZyA9IHdpZGdldFN0cmluZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkZHNoQnJkLndpZGdldHNTbSA9IHdpZGdldFN0cmluZztcbiAgICAgICAgfVxuXG4gICAgICAgICRkc2hCcmQuc2F2ZVdpZGdldHMoKTtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2Rhc2hib2FyZC52aWV3Jyk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5kZWxldGVXaWRnZXQgPSBmdW5jdGlvbiAod2lkZ2V0KSB7XG4gICAgICAgICRzY29wZS53aWRnZXRzID0gJHNjb3BlLndpZGdldHMuZmlsdGVyKGZ1bmN0aW9uIChlbGVtZW50KXtcbiAgICAgICAgICByZXR1cm4gZWxlbWVudC51cmwgIT0gd2lkZ2V0LnVybDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJGRzaEJyZC5zYXZlV2lkZ2V0cygpO1xuICAgICAgfVxuXG4gICAgICAkc2NvcGUudG9nZ2xlRHJhZ2dhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBncmlkT3B0aW9ucy5kcmFnZ2FibGUuZW5hYmxlZCA9ICFncmlkT3B0aW9ucy5kcmFnZ2FibGUuZW5hYmxlZDtcbiAgICAgICAgJHNjb3BlLnVybHNFbmFibGVkID0gISRzY29wZS51cmxzRW5hYmxlZDtcblxuICAgICAgICBpZiAoJHNjb3BlLmRlbGV0ZUVuYWJsZWQpIHtcbiAgICAgICAgICAkc2NvcGUuZGVsZXRlRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICRzY29wZS5kZWxldGVJY29uID0gJ2ltZy9feC5wbmcnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdyaWRPcHRpb25zLmRyYWdnYWJsZS5lbmFibGVkKSB7XG4gICAgICAgICAgJHNjb3BlLmxvY2tJY29uID0gJ2ltZy9fbG9ja2VkUmVkLnBuZyc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJHNjb3BlLmxvY2tJY29uID0gJ2ltZy9fbG9ja2VkLnBuZyc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWdyaWRPcHRpb25zLmRyYWdnYWJsZS5lbmFibGVkKVxuICAgICAgICAkZHNoQnJkLnNhdmVXaWRnZXRzKCk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS50b2dnbGVEZWxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRzY29wZS5kZWxldGVFbmFibGVkID0gISRzY29wZS5kZWxldGVFbmFibGVkO1xuICAgICAgICAkc2NvcGUudXJsc0VuYWJsZWQgPSAhJHNjb3BlLnVybHNFbmFibGVkO1xuXG4gICAgICAgIGlmICgkc2NvcGUuZGVsZXRlRW5hYmxlZCkge1xuICAgICAgICAgICRzY29wZS5kZWxldGVJY29uID0gJ2ltZy9feFJlZC5wbmcnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRzY29wZS5kZWxldGVJY29uID0gJ2ltZy9feC5wbmcnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdyaWRPcHRpb25zLmRyYWdnYWJsZS5lbmFibGVkKSB7XG4gICAgICAgICAgZ3JpZE9wdGlvbnMuZHJhZ2dhYmxlLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAkc2NvcGUubG9ja0ljb24gPSAnaW1nL19sb2NrZWQucG5nJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBnZXRJY29ucygpIHtcbiAgICAgICAgYXBpRGF0YS5nZXRJY29ucygpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChpY29ucykge1xuICAgICAgICAgICRkc2hCcmQuaWNvbnMgPSBpY29ucztcbiAgICAgICAgfSlcbiAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICRkc2hCcmQuYWxsSWNvbnMgPSBbXTtcbiAgICAgICAgICB2YXIgbGVuID0gJGRzaEJyZC5pY29ucy5sZW5ndGg7XG5cbiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpY29uT2JqID0ge307XG4gICAgICAgICAgICB2YXIgaWNvblN0cmluZyA9ICdpbWcvaWNvLycgKyAkZHNoQnJkLmljb25zW2ldO1xuICAgICAgICAgICAgaWNvbk9iai5wYXRoID0gaWNvblN0cmluZztcbiAgICAgICAgICAgICRkc2hCcmQuYWxsSWNvbnMucHVzaChpY29uT2JqKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgJHNjb3BlLnNob3duSWNvbnMgPSBbXTtcbiAgICAgICAgICAkc2NvcGUubG9hZFNvbWVJY29ucygpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgJHNjb3BlLmxvYWRBbGxJY29ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFsbEljb25zID0gW107XG4gICAgICAgIHZhciB0b3RhbEljb25zID0gJGRzaEJyZC5hbGxJY29ucy5sZW5ndGggLSAxO1xuICAgICAgICAkc2NvcGUuYXJlSWNvbnNMb2FkZWQgPSB0cnVlO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IHRvdGFsSWNvbnM7IGkrKykge1xuICAgICAgICAgIHZhciBuZXdJY28gPSAkZHNoQnJkLmFsbEljb25zW2ldXG4gICAgICAgICAgYWxsSWNvbnMucHVzaChuZXdJY28pO1xuICAgICAgICB9XG4gICAgICAgICRzY29wZS5zaG93bkljb25zID0gYWxsSWNvbnM7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5sb2FkU29tZUljb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSAyNDsgaSsrKSB7XG4gICAgICAgICAgdmFyIG5ld0ljbyA9ICRkc2hCcmQuYWxsSWNvbnNbaV1cbiAgICAgICAgICAkc2NvcGUuc2hvd25JY29ucy5wdXNoKG5ld0ljbyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgJHNjb3BlLmdyaWRzdGVyTW9kYWxPcHRpb25zID0gZ3JpZHN0ZXJNb2RhbE9wdGlvbnM7XG4gICAgICAkc2NvcGUuc2VsZWN0ZWRJY29uID0gXCJpbWcvX2JsYW5rLnBuZ1wiO1xuXG4gICAgICAkc2NvcGUuc2VsZWN0SWNvbiA9IGZ1bmN0aW9uIChpY29uUGF0aCkge1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRJY29uID0gaWNvblBhdGg7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5vcGVuTWFpbk1vZGFsID0gZnVuY3Rpb24gKHNpemUsIHBhcmVudFNlbGVjdG9yKSB7XG4gICAgICAgIGdyaWRPcHRpb25zLmRyYWdnYWJsZS5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgICRzY29wZS5kZWxldGVFbmFibGVkID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIHBhcmVudEVsZW0gPSBwYXJlbnRTZWxlY3RvciA/XG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnRbMF0ucXVlcnlTZWxlY3RvcignLm1vZGFsLWRlbW8nKSkgOiB1bmRlZmluZWQ7XG5cbiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdtYWluTW9kYWwuaHRtbCcsXG4gICAgICAgICAgY29udHJvbGxlcjogJ2Rhc2hib2FyZEN0cmwnLFxuICAgICAgICAgIHNpemU6ICdsZycsXG4gICAgICAgICAgYXBwZW5kVG86IHBhcmVudEVsZW1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUub3BlbkF1dGhNb2RhbCA9IGZ1bmN0aW9uIChzaXplLCBwYXJlbnRTZWxlY3Rvcikge1xuICAgICAgICB2YXIgcGFyZW50RWxlbSA9IHBhcmVudFNlbGVjdG9yID9cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudFswXS5xdWVyeVNlbGVjdG9yKCcubWFpbi1tb2RhbCcpKSA6IHVuZGVmaW5lZDtcblxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2F1dGhNb2RhbC5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnYXV0aEN0cmwnLFxuICAgICAgICAgIGNvbnRyb2xsZXJBczogJyRhdXRoJyxcbiAgICAgICAgICBhcHBlbmRUbzogcGFyZW50RWxlbSxcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUub25Mb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGF1dGgubG9nb3V0KCk7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQudmlldycpO1xuICAgICAgfVxuXG4gICAgICAkc2NvcGUuc3luY1dpZGdldHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRkc2hCcmQud2lkZ2V0c0xnID0gJHNjb3BlLndpZGdldHM7XG4gICAgICAgICRkc2hCcmQud2lkZ2V0c1NtID0gJHNjb3BlLndpZGdldHM7XG4gICAgICAgICRkc2hCcmQuc2F2ZVdpZGdldHMoKTtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2Rhc2hib2FyZC52aWV3Jyk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5yZXNldFdpZGdldHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNoZWNrU2NyZWVuU2l6ZSgpO1xuXG4gICAgICAgIGFwaURhdGEuZ2V0RGVmYXVsdEdyaWQoKVxuICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGVmYXVsdEdyaWQpIHtcbiAgICAgICAgICBkZWZhdWx0R3JpZCA9IGFuZ3VsYXIuZnJvbUpzb24oZGVmYXVsdEdyaWQpO1xuICAgICAgICAgICRzY29wZS53aWRnZXRzID0gZGVmYXVsdEdyaWQ7XG4gICAgICAgICAgaWYgKCRkc2hCcmQuc2NyZWVuU2l6ZSA9PSAnbGcnKSB7XG4gICAgICAgICAgICAkZHNoQnJkLndpZGdldHNMZyA9IGRlZmF1bHRHcmlkO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkZHNoQnJkLndpZGdldHNTbSA9IGRlZmF1bHRHcmlkO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkZHNoQnJkLnNhdmVXaWRnZXRzKCk7XG4gICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2Rhc2hib2FyZC52aWV3Jyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAkc2NvcGUuY2xlYXJHcmlkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkc2NvcGUud2lkZ2V0cyA9IFtdO1xuICAgICAgICBpZiAoJGRzaEJyZC5zY3JlZW5TaXplID09ICdsZycpIHtcbiAgICAgICAgICAkZHNoQnJkLndpZGdldHNMZyA9IFtdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRkc2hCcmQud2lkZ2V0c1NtID0gW107XG4gICAgICAgIH1cbiAgICAgICAgJGRzaEJyZC5zYXZlV2lkZ2V0cygpO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGFzaGJvYXJkLnZpZXcnKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHJlc2l6ZUJyZWFrcyA9IHtcbiAgICAgICAgJ3NtJyA6IDUwMFxuICAgICAgfTtcblxuICAgICAgZnVuY3Rpb24gaW5wdXRTY3JlZW5TaXplKHdpZHRoKSB7XG4gICAgICAgIGlmICh3aWR0aCA+IDUwMCkge1xuICAgICAgICAgIHJldHVybiAnbGcnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAnc20nO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvbGRXaWR0aCA9ICRkc2hCcmQuY3VycmVudFdpZHRoO1xuICAgICAgICB2YXIgb2xkU2l6ZSA9ICRkc2hCcmQubGFzdFNjcmVlblNpemU7XG4gICAgICAgIHZhciBuZXdXaWR0aCA9ICR3aW5kb3cub3V0ZXJXaWR0aDtcbiAgICAgICAgdmFyIG5ld1NpemUgPSBpbnB1dFNjcmVlblNpemUobmV3V2lkdGgpO1xuXG4gICAgICAgIGlmIChvbGRTaXplICE9PSBuZXdTaXplKSB7XG4gICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2Rhc2hib2FyZC52aWV3Jyk7XG4gICAgICAgIH1cblxuICAgICAgICAkZHNoQnJkLmxhc3RTY3JlZW5TaXplID0gbmV3U2l6ZTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
